name: Build and publish the LVE website

on:
  push:
    branches:
      - website


jobs:
    publish:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v3
          - name: Setup Fresh Virtual Environment
            run: |
              pip install --upgrade pip
              python3.10 -m venv env
              export PATH=$PATH:/home/docker/.local/bin
              source env/bin/activate
              echo "VIRTUAL ENV:" $VIRTUAL_ENV
          - name: Install Packaging Dependencies
            run: |
              pip install Markdown gitpython
              pip install -e lve-tools/
          - name: Build web/
            run: cd web && PYTHONPATH=../lve-tools/lve_tools python3 make.py
        
          - name: Deploy
            uses: s0/git-publish-subdir-action@develop
            env:
              REPO: self
              BRANCH: web
              FOLDER: web/build
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}